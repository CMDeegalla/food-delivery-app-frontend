<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<title>Track Order – FoodGo</title>

<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

<style>
  .iphone {
    width: 390px;
    height: 844px;
    border-radius: 40px;
    overflow: hidden;
    border: 2px solid black;
    background: #fafafa;
    position: relative;
  }

  /* Accessibility */
  .sr-only { position:absolute; width:1px; height:1px; overflow:hidden; clip:rect(0,0,0,0); }
  .iphone.high-contrast { background:#000 !important; color:#fff !important; }
  .iphone.high-contrast * { color:#fff !important; background-color:transparent !important; }
  .iphone.large-text { font-size:1.1rem; }
  .iphone.large-text * { font-size:inherit; }
  .iphone.dyslexia-mode { font-family:system-ui,sans-serif; letter-spacing:0.03em; line-height:1.4; }

  /* Progress bar */
  .progress-bar {
    height: 10px;
    background: #fde2e2;
    border-radius: 20px;
    overflow: hidden;
  }
  .progress-fill {
    height: 100%;
    width: 0%;
    background: #ef4444;
    border-radius: inherit;
    transition: width 1s ease-in-out;
  }
</style>
</head>

<body class="bg-gray-900 flex justify-center items-center h-screen">

<!-- PHONE FRAME -->
<div class="iphone" role="application" aria-label="Live order tracking">

  <div id="announce" class="sr-only" aria-live="polite"></div>

  <!-- HEADER -->
  <header class="absolute top-0 left-0 w-full bg-white/40 backdrop-blur-xl p-5 flex justify-between items-center z-20">
    <button onclick="window.location.href='index.html'"
      class="w-10 h-10 bg-white rounded-full shadow flex items-center justify-center">
      <span class="material-icons text-gray-700">arrow_back</span>
    </button>

    <h1 class="text-lg font-extrabold tracking-tight">Track Order</h1>

    <button id="accBtn"
      class="w-10 h-10 bg-white rounded-full shadow flex items-center justify-center"
      aria-label="Accessibility options">
      <span class="material-icons text-gray-700">accessibility_new</span>
    </button>
  </header>

  <!-- Accessibility Panel -->
  <section id="accPanel"
    class="absolute top-20 right-5 bg-white rounded-xl shadow-xl p-3 text-xs w-48 hidden z-40">
    <p class="font-semibold mb-2">Accessibility</p>
    <label class="flex items-center gap-2 mb-1"><input type="checkbox" id="toggleHC"> High contrast</label>
    <label class="flex items-center gap-2 mb-1"><input type="checkbox" id="toggleLT"> Larger text</label>
    <label class="flex items-center gap-2"><input type="checkbox" id="toggleDX"> Dyslexia-friendly</label>
  </section>

  <!-- MAP + DOT ANIMATION -->
  <div class="mt-24 px-5 relative">
    <img src="images/track.png" alt="Map view" class="w-full h-64 rounded-3xl object-cover shadow-lg">

    <!-- SVG Route + Red Dot -->
    <svg id="mapSVG" class="absolute top-0 left-0 w-full h-64 pointer-events-none" viewBox="0 0 390 256">

      <!-- PATH (edit control points if your map changes) -->
      <path id="routePath"
        d="M40 210 C 120 130, 220 200, 330 70"
        stroke="white" stroke-width="6" fill="none" stroke-linecap="round" opacity="0.85" />

      <!-- MOVING RED DOT -->
      <circle id="riderDot" r="8" fill="red" stroke="white" stroke-width="3"></circle>

    </svg>
  </div>

  <!-- DELIVERY STATUS -->
  <div class="mt-6 px-6">

    <p class="font-bold text-gray-700">Delivery Progress</p>

    <div class="mt-3 progress-bar "><div id="progressFill" class="progress-fill bg-orange-500"></div></div>

    <div class="mt-4 space-y-3 text-sm">
      <p id="s1" class="flex items-center gap-2">
        <span class="material-icons text-green-500">check_circle</span> Order Received
      </p>
      <p id="s2" class="flex items-center gap-2 text-black">
        <span class="material-icons">radio_button_unchecked</span> Preparing Order
      </p>
      <p id="s3" class="flex items-center gap-2 text-black">
        <span class="material-icons">radio_button_unchecked</span> Rider on The Way
      </p>
      <p id="s4" class="flex items-center gap-2 text-black">
        <span class="material-icons">radio_button_unchecked</span> Delivered
      </p>
    </div>

  </div>

  <!-- RIDER CARD -->
  <div class="px-6 mt-6">
    <div class="bg-white rounded-2xl shadow-lg p-4 flex items-center gap-4">
      <img src="images/male.jpg" class="w-16 h-16 rounded-full border-2 border-gray-800 object-cover">

      <div>
        <p class="font-bold text-gray-700 text-sm">Your Rider</p>
        <p class="text-gray-500 text-xs">Tharindu Perera</p>
      </div>

      <button class="ml-auto bg-blue-600 text-white w-10 h-10 rounded-full flex items-center justify-center">
        <span class="material-icons">call</span>
      </button>
    </div>
  </div>

  <!-- ETA -->
  <div class="px-6 mt-4">
    <div class="bg-white rounded-2xl shadow-lg p-4 text-center">
      <p class="text-gray-500 text-sm">Estimated Arrival</p>
      <p id="eta" class="text-lg font-bold text-black">12–18 min</p>
    </div>
  </div>

</div>

<script>
/* 
   Screen Reader Helper
*/
function say(msg) {
  document.getElementById("announce").textContent = msg;
}

/*
   MAP DOT MOVEMENT 
*/
const route = document.getElementById("routePath");
const dot = document.getElementById("riderDot");
let length = route.getTotalLength();

let step = 1;        // current tracking step
let currentPos = 0;  // 0–1 range position along path

// Target positions for each step
const positions = {
  1: 0.10,
  2: 0.40,
  3: 0.75,
  4: 1.00
};

// Smoothly move dot along path
function moveDotTo(step) {
  const target = positions[step];
  const start = currentPos;
  const duration = 1200;
  const startTime = performance.now();

  function animate(time) {
    let t = Math.min((time - startTime) / duration, 1);
    let pos = start + (target - start) * t;
    currentPos = pos;

    let pt = route.getPointAtLength(length * pos);
    dot.setAttribute("cx", pt.x);
    dot.setAttribute("cy", pt.y);

    if (t < 1) requestAnimationFrame(animate);
  }

  requestAnimationFrame(animate);
}

/* ----------------------------
   STATUS UI / PROGRESS BAR
-----------------------------*/
function markStep(n) {
  const steps = ["s1", "s2", "s3", "s4"];
  steps.forEach((id, i) => {
    const el = document.getElementById(id);
    if (i < n) {
      el.classList.remove("text-gray-400");
      el.classList.add("text-green-500", "font-semibold");
      el.children[0].textContent = "check_circle";
    } else {
      el.classList.remove("text-green-500","font-semibold");
      el.classList.add("text-gray-400");
      el.children[0].textContent = "radio_button_unchecked";
    }
  });
}

function updateTracking() {
  if (step === 1) {
    document.getElementById("progressFill").style.width = "15%";
    markStep(1);
    moveDotTo(1);
    say("Order received");
  }
  else if (step === 2) {
    document.getElementById("progressFill").style.width = "45%";
    markStep(2);
    moveDotTo(2);
    say("Order is being prepared");
  }
  else if (step === 3) {
    document.getElementById("progressFill").style.width = "75%";
    markStep(3);
    moveDotTo(3);
    say("Rider is on the way");
  }
  else if (step === 4) {
    document.getElementById("progressFill").style.width = "100%";
    markStep(4);
    moveDotTo(4);
    say("Order delivered");
  }
}

// Start tracking
updateTracking();

// Update every 4 seconds
setInterval(() => {
  step++;
  if (step <= 4) updateTracking();
}, 4000);

/* ETA randomizer */
document.getElementById("eta").textContent =
  `${10 + Math.floor(Math.random()*6)}–${16 + Math.floor(Math.random()*6)} min`;

/* 
   Accessibility Panel
*/
const phone = document.querySelector(".iphone");
document.getElementById("accBtn").onclick = () =>
  document.getElementById("accPanel").classList.toggle("hidden");

document.getElementById("toggleHC").onchange = e => phone.classList.toggle("high-contrast", e.target.checked);
document.getElementById("toggleLT").onchange = e => phone.classList.toggle("large-text", e.target.checked);
document.getElementById("toggleDX").onchange = e => phone.classList.toggle("dyslexia-mode", e.target.checked);

</script>

</body>
</html>
